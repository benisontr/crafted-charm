<%- include('./partials/header') %>

<div class="wrapper">
  <%- include('./partials/adminHeader') %>
  <%- include('./partials/sidebar') %>

  <div class="page-content">
    <!-- Start Container Fluid -->
    <div class="container-xxl">
      <div class="row">
        <div class="col-xl-12 col-lg-12">
          <form id="CategoryForm"  enctype="multipart/form-data">
            <!-- Upload Card -->
            <div class="card">
              <div class="card-header">
                <h4 class="card-title">Add Thumbnail Photo</h4>
              </div>
              <div class="card-body">
                <!-- File Upload -->
                <input type="file" 
                       name="thumbnail[]" 
                       class="filepond"
                       multiple 
                       data-max-file-size="3MB"
                       data-max-files="5"
                       accept="image/png, image/jpeg, image/gif" />
                <small class="text-muted fs-13 d-block mt-2">
                  1600 x 1200 (4:3) recommended. PNG, JPG and GIF files are allowed.
                </small>
              </div>
            </div>

            <!-- Info Card -->
            <div class="card">
              <div class="card-header">
                <h4 class="card-title">General Information</h4>
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-lg-6">
                    <div class="mb-3">
                      <label for="categoryId" class="form-label">Category ID</label>
                      <input type="text" id="categoryId" name="categoryId" class="form-control" disabled value="<%= categoryId %>">
                      <input type="hidden" name="categoryId" value="<%= categoryId %>">
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="mb-3">
                      <label for="categoryName" class="form-label">Category Title</label>
                      <input type="text" id="categoryName" name="categoryName" class="form-control" placeholder="Enter Title">
                    </div>
                  </div>
                  <div class="col-lg-12">
                    <div class="mb-0">
                      <label for="description" class="form-label">Description</label>
                      <textarea class="form-control bg-light-subtle" id="description" name="description" rows="7" placeholder="Type description"></textarea>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Buttons -->
            <div class="p-3 bg-light mb-3 rounded">
              <div class="row justify-content-end g-2">
                <div class="col-lg-2">
                  <button type="submit" class="btn btn-outline-secondary w-100">Save Change</button>
                </div>
                <div class="col-lg-2">
                  <a href="#!" class="btn btn-primary w-100">Cancel</a>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
    <!-- End Container Fluid -->
  </div>

  <%- include('./partials/footer') %>
</div>

<!-- ✅ FilePond Styles -->
<link href="https://unpkg.com/filepond@^4/dist/filepond.css" rel="stylesheet" />
<link href="https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.css" rel="stylesheet" />

<!-- ✅ FilePond Scripts -->
<script src="https://unpkg.com/filepond@^4/dist/filepond.js"></script>
<script src="https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.js"></script>

<script>
  // Register plugin
  FilePond.registerPlugin(FilePondPluginImagePreview);

  // Initialize FilePond
  FilePond.create(document.querySelector('.filepond'), {
    allowMultiple: true,
    maxFiles: 5,
    allowImagePreview: true,
    imagePreviewHeight: 170,
    acceptedFileTypes: ['image/png', 'image/jpeg', 'image/gif'],
    labelIdle: 'Drag & Drop your images or <span class="filepond--label-action">Browse</span>'
  });
</script>

<!-- ✅ Custom Preview Grid Styling -->
<style>
  .filepond--item {
    width: calc(25% - 0.5em); /* 4 per row */
  }

  .filepond--list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5em;
  }
</style>

     <script>
  // On document ready
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("CategoryForm");

    form.addEventListener("submit", function (e) {
      e.preventDefault();

      const formData = new FormData(form);

      // Append FilePond files manually
      const pondFiles = FilePond.find(document.querySelector('.filepond')).getFiles();
      pondFiles.forEach((file, index) => {
        formData.append("thumbnail[]", file.file);
      });

      fetch("/admin/add-category", {
        method: "POST",
        body: formData,
      })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            alert("Category added successfully!");
            window.location.href = "/admin/list-category"; // Redirect if needed
          } else {
            alert("Failed to add category: " + (data.message || "Unknown error"));
          }
        })
        .catch(err => {
          console.error("Error:", err);
          alert("An error occurred while adding the category.");
        });
    });
  });
</script>
