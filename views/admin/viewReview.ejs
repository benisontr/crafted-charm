<%- include('./partials/header') %>

  <div class="wrapper">
    <%- include('./partials/adminHeader') %>
      <%- include('./partials/sidebar') %>

        <main class="content-area" style=" padding: 2rem;">
          <div class="container">
            <div class="d-flex justify-content-between align-items-center mb-4">
              <h2 class="text-danger fw-bold"> Review List</h2>
              <!-- <a href="/admin/add-offers" class="btn btn-primary fw-semibold">‚ûï Add Offer</a> -->
            </div>

            <!-- üîß MOCK STATIC DATA since backend is not working -->
            <div class="table-responsive">
              <table class="table table-bordered table-striped align-middle">
                <thead class="table-dark">
                  <tr>
                    <th>#</th>
                    <th>UserId</th>
                    <th>ProductId</th>
                    <th>Rating</th>
                    <th>Review</th>
                    
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
               <% if (reviews.length > 0) { %>
  <% reviews.forEach((review, index) => { %>
    <tr>
      <td><%= index + 1 %></td>
      <td><%= review.userId.userId %></td>
     <td><%= review.productId ? review.productId.productId : 'N/A' %></td>

      <td><%= review.rating %></td>
      <td><%= review.review %></td>
     
   
      <td>

       <form action="/admin/delete-review/<%= review._id %>" method="POST" style="display:inline;">
  <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this review?');">
    üóëÔ∏è Delete
  </button>
</form>

      </td>
    </tr>
 

                       
  <% }) %>
<% } else { %>
  <tr><td colspan="8" class="text-center">No Reviews found</td></tr>
<% } %>


                </tbody>
              </table>
            </div>

          </div>
        </main>
  </div>

 
    <style>
      .content-area {
        margin-left: 250px;
        padding: 2rem;
        transition: margin-left 0.3s ease;
      }

      @media (max-width: 768px) {
        .content-area {
          margin-left: 0 !important;
          padding: 1rem;
        }
      }
    </style>

   <script>
  document.querySelectorAll('.delete-offer-btn').forEach(button => {
    button.addEventListener('click', async function () {
      const offerId = this.dataset.offerId;

      if (confirm('Are you sure you want to delete this offer?')) {
        try {
          const response = await fetch(`/admin/delete-offer/${offerId}`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            }
          });

          if (response.ok) {
            // Remove the row or card from the DOM
            this.closest('.offer-row').remove(); // Make sure each offer is wrapped in a div with class "offer-row"
          } else {
            alert('Failed to delete offer.');
          }
        } catch (error) {
          console.error('Delete failed:', error);
          alert('Something went wrong.');
        }
      }
    });
  });
</script>
